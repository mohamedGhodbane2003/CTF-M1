from sympy import mod_inverse
from gmpy2 import iroot

def retrieve_message(c1, c2, c3, N1, N2, N3, e):
    t1 = c1 * (N2 * N3) * mod_inverse(N2 * N3, N1)
    t2 = c2 * (N1 * N3) * mod_inverse(N1 * N3, N2)
    t3 = c3 * (N1 * N2) * mod_inverse(N1 * N2, N3)
    c = (t1 + t2 + t3) % (N1 * N2 * N3)
    m,_ = iroot(c, e)
    return int(m)
def bytes_needed(n):
    if n == 0:
        return 1
    bits = n.bit_length()
    return (bits + 7) // 8


c1 = int("40bef79ee4154dfada57f7616f52aa898ccbafb8d67ffc5e516a5d4a729ee05dee3139d4222091225cc6a8eefcb9d693da38df39154f3f0b838cd302f81eafd66f3706965e20e656953ce4253820ed5d05d952b01d3c512f53920b03d4da25c60845676d08b4719d12f09f3d6a5c864ce05a5cba4e9cc9e0820e10dd6d1ee9565343b93a5b5c8428594018d718e675d7ad50ca259aff0289aabffe039c20f44bb772966a990731dd36641e2628af40cf16c42987a76c95d5948a3779e2e492bbbac1f118e2407f58f5289dae4516466438350cc244e098b2c08e9ff4a89909e429320b8c4751ce956ae7ee4e157330d7dc50e91bd49e3f4286f206d264e8116e",16)
c2 = int("39f9b90e8f06726297e7d41dfbb4c1f6e94f3e93d3e0e1f8dc809f1011b588a843ec61efc1c92049291df0147bfa3315b3529a409a96ddab452a468e5131b59613c668f1ffdd82739295006a7daf1e93191b89e9060ec92fbd43d0e294f20fc54867d204b5257711bdfde5357c7ab828030f5f5e2150af8102d212af841e897c569d1fcf3dd0bd76eac6033cbbcc65d31351d0b8e0ad06318426fd08d15e85fc2c5a9ed10e616dad742d11c141f70f978c225c3014f773b6592c5004eea746d57680525e15ad1cab84cb75b6b4fbadaa1fce40e2624d9e18c8da5fc5bfdc262691120445b786dcc08c02ba6ef3a4466bf515aebd7ffa8b812fc1267323d604c3",16)
c3 = int("509554448ba08cb37716e967ce9862f5ae5d9e38c38a2222fa6dbf582dc6e1fa22bf7dec1ddf11ade322adbf90b85eebce2f0b8cc3abd4173caa6199039c3069afdeca58f304a59f5ac6fdeee1b96ebbc1ca91ba8bb446e3d3cf9f9842ec5d50920581509f1948cbc7e86cc95e8f8c4c089ee91b22875974e05bcec1622552a90f5fa6210b8d2deeeba3a7819c59333702d2d1b7683d669512b704df8c98773ed4f872cfd3446f5ddb6e3c686699a20c0a709bfeb41805f10d3396cbe11a4120ec5bc918688327758af736c21ade59bc7cdaaef1c7a4006c8bfbb72954e16d5bdadfbdfb0be5dcdf5899de57e6f56cf660fd3674c25f7b56ca4cc79870ae3c1f",16)
N1 = 26918578506782502928144529840583268091357355557126839009904399047167501263338018128769761194499779877586920336184839735438293679120729067082660558822606300578376073478553426756058594403670545206751758655575700954529175766067965991366022182436878996212903376072407080119527921386185349253601634123490379907394197468554296191363648980352867300899143698114075284161252972579532914458132767937628356809935144891620110435031116451455044131973085559878204504735973468951631320741904041718837870262795875350921924409187482653773463489944040078850112785276040197147645234252762639865799679872797875278594600473749204668942289
N2 = 19740808211022945857214181423410408689677892607780106064985884686453652828988067412343484385372741705336169845817636873996659424364043736274744478824433995293392600009234551469503636433704459275444271326192202913592806041859592255064514359643274755387534595621434700844889651379206130407023338473582315845109780326578281848229458372346426862805418871486297808762249171625131880616788933308838863067699745208873263866995521465493208757078512787529826808656017651568720292108927747576125404831547196739662114413431889693263772183401146675651246730650806582112369548258835298824341623285433972679165439558722341355058903
N3 = 26180314040651947825092924481457232269450114343598603912503561416527404444935310637414028253482146640049453244877313165989886158014684025091360481809488934354522679434758856855479377988199620742134886110764377960791698181606519786048954525608517589969264564709033580316628273979876586321768674781122537036893544802649985075202299288738719546131887546359378998102160493610757202745966678245717027281452360340217582805225244668236568935919686104422190954748341724573654890802726727080482076792228908399858309672768178904158113322771345309892109629131304855958495273555957967288203236769695969599146536649693303060453909
e = 3


m = retrieve_message(c1, c2, c3, N1, N2, N3, e)
m_bytes = m.to_bytes(bytes_needed(m), 'big')
print(m_bytes)

print(m_bytes)




